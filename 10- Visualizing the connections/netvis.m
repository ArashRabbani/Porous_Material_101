function []=netvis(Connections,Centers,Property)
% Assume that we have a network with N nodes and M links
% Connections is a Mx2 array containing the id of nodes that are located at two ends of each link
% Centers is a Nx3 array containing x,y, and z coordinates of each node
% Property is Nx1 or Mx1 array that can be visualized on the network by colors
% if you give the node properties, he code will interpolate it for links
% and vice versa

% If you are using this code in your research feel free to cite this paper: 
% Rabbani, A., & Babaei, M. (2019). Hybrid pore-network and lattice-Boltzmann permeability 
% modelling accelerated by machine learning. Advances in Water Resources, 126, 116-128.

% Example: 
% Connections=[5,3;11,10;16,7;8,16;17,13;8,18;16,18;20,2;21,8;21,16;21,18;22,4;22,6;18,24;1,25;12,27;22,28;28,23;29,20;26,29;30,22;31,7;9,31;31,16;31,22;27,31;31,30;27,32;19,33;34,27;34,32;33,34;36,27;36,34;37,23;39,38;40,21;40,32;29,42;18,43;43,24;41,45;46,22;46,26;46,27;46,30;31,46;46,37;46,42;44,46;18,47;47,43;48,2;48,35;49,41;49,45;50,40;42,51;46,51;51,48;4,52;31,52;43,52;53,43;47,53;53,52;38,55;55,41;55,49;56,18;36,57;59,45;49,59;55,59;57,60;43,61;53,61;62,55;57,63;63,60;52,64;65,56;66,50;58,66;63,66;67,35;67,48;64,67;46,68;69,65;70,52;70,53;63,71;66,71;46,72;59,72;73,65;69,73;42,74;46,74;74,48;74,51;72,74;65,75;69,75;71,75;75,73;61,76;59,77;72,77;74,77;78,53;78,70;73,78;76,79;80,67;81,69;82,48;74,82;77,82;80,82;68,83;83,70;83,80;84,25;61,84;84,76;84,79;67,85;85,79;80,85;78,86;86,84;87,68;88,68;71,88;87,88;89,87;89,88;90,71;90,75;79,91;84,91;69,92;81,92;39,93;93,46;93,68;87,93;94,70;75,94;94,78;94,83;95,68;95,83;87,95;96,86;97,87;92,98;98,96;99,81;100,90;87,101;101,95;102,97;87,103;101,103;104,82;105,90;87,106;97,106;102,106;107,100;99,108;100,108;109,86;109,94;109,101;105,110;110,109;111,77;111,82;103,111;111,104;113,87;114,82;104,114;111,114;93,115;115,112;102,116;116,106;103,117;117,109;117,111;90,118;98,118;108,118;118,109;107,119;111,120;120,114;109,123;109,124;117,124;111,126;112,126;115,126;126,120;113,127;109,128;124,128;129,115;129,126;109,131;134,129;116,135;135,132;136,116;135,136;139,132;135,139;138,139;140,115;140,126;127,141;141,132;139,141;119,142;143,142;139,144;144,141;123,147;133,148;148,146;145,149;149,146;150,128;131,150;151,140;151,150;152,129;153,131;153,150;154,133;154,145;105,155;155,118;119,155;155,122;155,127;141,155;142,155;143,155;155,154;156,136];
% Centers=[19.1406250000000,10.2343750000000,15.9375000000000;22.0476545048399,339.988830975428,35.4690990320179;76.8817204301075,492.392473118280,12.0698924731183;107.256740914420,169.150058616647,29.6776084407972;121.693548387097,492.096774193548,8.79032258064516;168.950617283951,274.485596707819,12.6954732510288;239.452054794521,171.575342465753,11.7808219178082;323.726554787759,72.0483711747285,14.7630799605133;348.796296296296,240.462962962963,12.5000000000000;363.333333333333,480.740740740741,13.0864197530864;398.924050632911,479.715189873418,16.9936708860760;443,202.216216216216,10.7567567567568;265.086206896552,496.465517241379,20.6034482758621;473.384615384615,104.884615384615,21.6346153846154;496.683168316832,43.7128712871287,32.0792079207921;263.394093216428,77.0096908167974,36.3082602676511;295.769230769231,485.976331360947,51.4201183431953;178.192511272300,30.4440305822388,63.2444618702215;488.732269503546,301.117021276596,51.7464539007092;68.4346378018318,394.375520399667,46.7485428809326;323.208607987592,84.8507173322993,79.9670414889492;209.710796915167,281.443444730077,38.1645244215938;89.4716494845361,285.425257731959,72.9510309278351;97.3770491803279,76.2021857923497,71.6803278688525;17.2555555555556,16.1666666666667,80.7444444444444;189.857142857143,390.439560439560,74.1868131868132;394.470752089137,232.929433611885,67.3212627669452;134.460093896714,282.417840375587,79.3896713615024;146.217457886677,408.583460949464,85.8039816232772;201.250000000000,277.339015151515,94.7916666666667;264.905780674412,235.945735335789,81.1894304335506;380.513698630137,182.328767123288,102.328767123288;490.136239782016,248.092643051771,90.7629427792916;413.029197080292,195,102.408759124088;11.2126865671642,248.488805970149,120.298507462687;423.578088578089,236.573426573427,114.032634032634;109.059633027523,295.894495412844,118.555045871560;179.568345323741,491.115107913669,117.841726618705;247.660614525140,482.597765363129,120.593575418994;413.266009852217,117.827586206897,111.029556650246;67.6075949367089,492.468354430380,106;89.6551724137931,368.078817733990,135.911330049261;119.141981613892,75.6690500510725,123.360572012257;380.962962962963,356.666666666667,133.481481481481;26.2099358974359,469.174679487180,131.682692307692;245.880080482897,327.653118712274,121.947283702213;130.178571428571,24.9744897959184,144.413265306122;14.6580188679245,317.032232704403,147.012578616352;71.8650793650794,493.108465608466,148.412698412698;444.118589743590,84.7596153846154,145.192307692308;53.9776951672862,355.055762081784,149.460966542751;119.723543400713,148.206004756243,150.860582639715;109.340638930163,88.8261515601783,172.745170876672;495,10.6944444444444,163.611111111111;117.106918238994,479.795597484277,153.655660377359;263.286852589641,13.2768924302789,152.500000000000;460.498392282958,263.086816720257,163.424437299035;492.687500000000,145.562500000000,166;57.0176405733186,460.049614112459,166.703417861081;424.565217391304,292.347826086957,167.869565217391;66.6412213740458,53.0852417302799,176.545801526718;141.380597014925,495.932835820896,178.805970149254;444.602076124568,232.162629757785,177.923875432526;50.6808510638298,198.063829787234,184.127659574468;294.564777327935,35.6629554655870,182.580971659919;451.469804618117,165.390763765542,186.332149200711;30.9737827715356,226.722846441948,191.928838951311;253.759259259259,324.022222222222,212.433333333333;301.036988110964,35.4887714663144,219.339498018494;139.107268877911,143.338038108680,214.869442484121;384.995888157895,220.974506578947,214.551809210526;79.8192335502531,417.928416485900,213.678597252350;252.816377171216,71.5012406947891,215.620347394541;44.4692171269319,360.763871294654,200.932353686344;310.636033229491,112.993250259605,228.047767393562;18.1632653061224,76.8571428571429,224.448979591837;30.1870463428252,437.275265214964,247.495812395310;156.353055286130,94.3016488845781,234.684772065955;21.0398009950249,121.004975124378,277.320895522388;55.6670673076923,268.635817307692,244.837740384615;343.873390557940,16.1123032904149,223.247496423462;27.8200692041522,325.386801779535,261.029411764706;165.834230355221,213.969321851453,245.801937567277;44.9561206120612,34.8818631863186,238.941269126913;20.8842794759825,221.033478893741,259.992721979622;119.651360544218,38.9937641723356,278.324829931973;347.602290158028,396.624692326900,285.087396996397;387.856362046349,321.726060341058,276.669217315260;470.270159078442,365.843390016456,272.722161272628;395.695088044486,187.182576459685,292.395736793327;14.8230668414155,30.9567496723460,303.204456094364;286.818181818182,30.9358288770054,292.245989304813;238.243480441324,478.335005015045,272.419759277834;203.997458345100,174.848912736515,269.236091499576;186.925315227934,286.988360814743,284.747817652764;203.824561403509,12.3333333333333,306.140350877193;451.562974203338,461.332827516439,316.894284269095;271.713780918728,28.2420494699647,316.793286219081;443.464285714286,25.7142857142857,305.491071428571;468.692396313364,164.274193548387,315.247695852535;208.317039106145,297.856145251397,328.386871508380;465.641646489104,487.064164648910,351.973365617433;174.621273166801,341.974214343272,350.620467365028;38.0955882352941,339.959558823529,342.341911764706;375.673758865248,225.177304964539,356.666666666667;397.775665399240,485.095057034221,352.262357414449;486.516393442623,199.221311475410,357.233606557377;405.442477876106,110.398230088496,360.486725663717;171.370128298233,187.378358750908,372.797143548778;333.143939393939,241.780303030303,376.060606060606;83.3256930801135,360.752019209780,372.285527177472;80.8474576271186,490.677966101695,383.305084745763;423.553500660502,336.212021136063,405.459048877147;17.0374449339207,374.746696035242,389.823788546256;168.992792792793,474.091891891892,406.963963963964;402.926470588235,494.500000000000,392.323529411765;131.885057471264,332.402298850575,414.448275862069;320.871773169700,117.462970799831,401.925518408802;431.022067363531,162.537746806040,420.766550522648;31.7867616254713,377.494763301215,445.360284876414;312.403846153846,8.46153846153846,420.769230769231;344.595959595960,244.242424242424,425.454545454546;12.0754716981132,219.245283018868,428.018867924528;126.269230769231,296.423076923077,429.961538461538;495.625000000000,498.750000000000,431.250000000000;81.2178988326848,429.178988326848,442.416342412451;388.775303643725,289.625506072875,435.010121457490;111.960526315789,271.855263157895,445.342105263158;197.287319422151,478.924558587480,479.056982343499;216.357142857143,25.6428571428571,464.928571428571;208.892733564014,230.709342560554,465.034602076125;395.764818355641,372.294455066922,477.476099426386;159.358766233766,23.1087662337662,481.688311688312;300.176470588235,481.823529411765,480.941176470588;422.677902621723,427.322097378277,474.035580524345;453.451327433628,482.920353982301,465.327433628319;490.147058823529,15.9558823529412,482.904411764706;498.448275862069,333.620689655172,478.275862068966;456.954022988506,367.597701149425,484.879310344828;131.580547112462,401.527355623100,481.983282674772;389.136000000000,312.356000000000,482.232000000000;424.745989304813,143.930481283422,481.149732620321;451.395676691729,81.7246240601504,474.995300751880;443.018134715026,310.556994818653,485.025906735751;139.315789473684,137.842105263158,495.736842105263;48.0828220858896,40.6288343558282,493.880368098160;51.6431095406361,180.574204946996,483.480565371025;109.062500000000,40.0781250000000,495.039062500000;122.873563218391,87.5862068965517,498.620689655172;139.840336134454,282.008403361345,491.268907563025;144.179894179894,363.994708994709,494.206349206349;205.555555555556,427.444444444444,497.888888888889;232.724014336918,242.571684587814,493.458781362007;228.345959595960,81.8813131313131,492.727272727273;361.620683818551,149.151997291808,466.897427217332;485.552884615385,489.447115384615,488.293269230769];
% Property=[15.6318528359354;34.2215076538524;17.7056326464969;29.4164421698869;12.2764000149593;19.3557153111322;12.9632756105510;31.1513555482151;11.7238896269516;13.4205034340947;16.7684465244390;17.6738450868436;12.0065011211224;19.7969483748264;14.4448906714464;40.1384044725034;17.1488908486896;53.3939735987329;25.6271416401280;32.9701915543902;42.5360915414888;48.7817079355890;22.6230441522854;22.1871147595306;23.7690216283091;23.8567309899321;31.7940389788476;18.5239529420300;26.9098655764639;25.0698523063528;59.4978153108105;16.3327038173220;22.2073032281389;15.9899580225296;19.9979463644427;23.3933758583056;18.6677782100920;16.0673924409903;27.7488384591162;31.1718431276483;22.7582833244334;18.2294044476065;30.7988640306376;15.9117662692058;26.5054591063689;71.8410382866960;18.0174154067284;33.6074972426434;22.4269940507774;21.0373968341750;20.0227885593805;46.4756847254240;43.1484785172266;12.9038102074215;26.6742882384952;24.6514067106836;21.0148969273456;13.3650461757198;30.0245308652231;15.0836488947035;28.6251639817126;15.8723805480600;25.8374558407345;19.1409323644604;30.8929548311580;32.2690810657709;19.9730422958833;58.6194481347579;28.2686950616838;34.8388452210791;33.1068854540285;43.5402775510647;22.9109000106935;49.0188189649764;38.5915802248143;24.4533948927660;37.6679798867798;31.3347828699687;39.1446565559937;29.1730325559272;34.6824305295960;49.4252749612455;38.1319520106655;50.9954957359078;34.4828149977062;37.4777343207418;94.2244606625853;51.4879801111150;47.7396637764428;31.8137074274018;28.3431847210931;17.7373064754543;49.1879645215650;47.2769129030640;31.3347828699687;20.4121501625502;38.9292488828027;25.6573980338005;25.5664135887272;29.5878705279748;27.7488384591162;29.1027358194958;33.3322319320387;34.3652971899255;16.1440876005173;19.8727994926459;19.3822300227883;14.9956955897506;79.0033541509426;15.7930173192647;51.5142322724688;12.0751111882829;35.6163239612746;30.0355611861512;43.5874501530198;21.6487806577401;29.6105780353743;41.3137903933997;29.5081184685892;41.4531884648624;11.5773256420953;14.3489084968953;11.6510685579473;15.7128483379798;7.81592641796772;33.7216003546626;24.5197544986932;22.4664782767512;33.3769372323040;12.7832067943636;20.5072022908819;24.9904665553722;26.3917003711765;13.6378772276219;25.1644564190240;25.6422787621593;15.9509579700543;9.52956625506351;29.6105780353743;26.9783736765203;33.4126154392994;22.3476057968615;31.6655967747424;22.5841059614586;14.1529944489424;26.8961220267922;25.6573980338005;15.6318528359354;13.7440128365813;26.0883206155393;17.8003169743443;13.9002081722282;25.5359410764309;22.7774724425670;56.0730221095124;18.3778589032405];
% netvis(Connections,Centers,Property)

% Developed by Arash Rabbani
% rabarash@yahoo.com
% arashrabbani.com

figure;
if numel(Property)==size(Centers,1)
    Pval=Property; Tval=(Pval(Connections(:,1))+Pval(Connections(:,2)))./2;
end
if numel(Property)==size(Connections,1)
    Tval=Property;
    for I=1:numel(NW.R)
        Pval(I,1)=mean(Tval(unique([find(Connections(:,1)==I) ; find(Connections(:,2)==I)])));
    end
end
Tval=uint8(mat2gray(Tval).*255); Pval=uint8(mat2gray(Pval).*255);
PoreColor=squeeze(ind2rgb(Pval,jet(256)));
ThroatColor=squeeze(ind2rgb(Tval,jet(256)));
hold on;
x=Connections(:,1); y=Connections(:,2); C=Centers;
axis tight; hold on; axis equal ; view(30,40); light; grid;
X(1,:)=C(x(:),1); X(2,:)=C(y(:),1); Y(1,:)=C(x(:),2); Y(2,:)=C(y(:),2); Z(1,:)=C(x(:),3); Z(2,:)=C(y(:),3);
p =plot3(X,Y,Z,'LineWidth',2);
xlabel('X'); ylabel('Y') ; zlabel('Z'); 
for I=1:size(x,1)
    p(I).Color=ThroatColor(I,:);
end
scatter3(C(:,1),C(:,2),C(:,3),50,PoreColor, 'filled','MarkerEdgeColor','k')
box on;
data=Property;
     Max=max(data(:));
            Min=min(data(:));
            c=colorbar;
            Bin=[0:.1:1];
            c.Ticks=Bin;
            for I=1:numel(Bin)
                Labels(I)={num2str(round(Bin(I)*(Max-Min)+Min,3))};
            end
            c.TickLabels=Labels;
            c.Label.String='Property';
            colormap( jet(255));
end
